services:
  mongo_vector_main:
    container_name: mongo_vector_main
    image: mongodb/mongodb-community-server:latest
    command:
      - mongod
      - --bind_ip_all
    ports:
      - "27018:27017"
    restart: unless-stopped
    networks:
      - action_atlas
    volumes:
      - mongo_vector_data:/data/db
    environment:
      - MONGODB_INITDB_DATABASE=actionatlas
    healthcheck:
      test: ["CMD", "mongosh", "--eval", "db.adminCommand('ping')"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 40s

  mongo_vector_init:
    container_name: mongo_vector_init
    image: mongodb/mongodb-community-server:latest
    volumes:
      - ./scripts/docker-init:/app-initializer:ro
      - ./data:/seed-data:ro
    depends_on:
      mongo_vector_main:
        condition: service_healthy
    restart: "no"
    entrypoint: ["bash", "/app-initializer/vector-init.sh"]
    networks:
      - action_atlas

networks:
  action_atlas:
    driver: bridge

volumes:
  mongo_vector_data:
    driver: local
